<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>REG-01 Dev Console</title>
  <style>
    :root {
      --bg: #060b16;
      --bg-2: #0d1424;
      --panel: #111a2d;
      --panel-2: #18223a;
      --ink: #e5edf8;
      --muted: #9fb0cb;
      --border: #2a3858;
      --accent: #23c58f;
      --accent-2: #1aa379;
      --danger: #e05667;
      --warn: #f7c948;
      --mono-bg: #0a1222;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--ink);
      background:
        radial-gradient(1100px 500px at 15% -10%, rgba(35, 197, 143, 0.18), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(88, 133, 245, 0.2), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    .wrap {
      max-width: 1540px;
      margin: 24px auto;
      padding: 0 16px 32px;
    }
    .hero {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      background: linear-gradient(160deg, rgba(24, 34, 58, 0.92), rgba(17, 26, 45, 0.88));
      margin-bottom: 14px;
    }
    .hero h1 { margin: 0 0 6px; font-size: 25px; }
    .hero p { margin: 0; color: var(--muted); font-size: 14px; }
    .badge {
      display: inline-block;
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(247, 201, 72, 0.55);
      color: var(--warn);
      font-size: 12px;
      letter-spacing: 0.2px;
    }
    .card {
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 14px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.18);
    }
    .tabs-card {
      padding: 12px;
    }
    .tabs-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .tab-btn {
      border-radius: 999px;
      padding: 8px 14px;
      background: rgba(6, 11, 22, 0.82);
      border: 1px solid rgba(42, 56, 88, 0.95);
      color: #c7d6ec;
      font-size: 13px;
      font-weight: 600;
    }
    .tab-btn.active {
      background: rgba(35, 197, 143, 0.2);
      border-color: rgba(35, 197, 143, 0.88);
      color: #cbf8e8;
      box-shadow: 0 0 0 2px rgba(35, 197, 143, 0.2);
    }
    .tab-panel {
      display: none;
    }
    .tab-panel.active {
      display: block;
      animation: tab-fade .18s ease;
    }
    @keyframes tab-fade {
      from {
        opacity: 0.35;
        transform: translateY(3px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    h2 { margin: 0 0 10px; font-size: 18px; }
    p { margin: 0; color: var(--muted); }
    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .field { display: flex; flex-direction: column; gap: 6px; }
    .full { grid-column: 1 / -1; }
    label { font-size: 13px; color: var(--muted); }
    input, select, textarea, button {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 11px;
      font-size: 14px;
      background: rgba(6, 11, 22, 0.85);
      color: var(--ink);
      outline: none;
    }
    input, select, textarea {
      width: 100%;
    }
    input:focus, select:focus, textarea:focus {
      border-color: rgba(35, 197, 143, 0.85);
      box-shadow: 0 0 0 3px rgba(35, 197, 143, 0.18);
    }
    textarea {
      min-height: 94px;
      resize: vertical;
    }
    textarea.mono {
      min-height: 340px;
      background: var(--mono-bg);
      font-family: Consolas, "Courier New", monospace;
      font-size: 13px;
      line-height: 1.45;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    button {
      cursor: pointer;
      transition: transform .1s ease, background .2s ease, border-color .2s ease;
    }
    button:hover { transform: translateY(-1px); }
    button.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #071b16;
      font-weight: 600;
    }
    button.primary:hover {
      background: var(--accent-2);
      border-color: var(--accent-2);
    }
    button.danger {
      color: #fff;
      border-color: rgba(224, 86, 103, 0.9);
      background: rgba(224, 86, 103, 0.2);
    }
    .status {
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      white-space: pre-wrap;
    }
    .output {
      white-space: pre-wrap;
      background: var(--mono-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      min-height: 120px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 13px;
    }
    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
    }
    .graph-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .graph-toolbar .graph-spacer {
      flex: 1 1 auto;
      min-width: 8px;
    }
    .graph-zoom-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 86px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(42, 56, 88, 0.95);
      background: rgba(7, 13, 26, 0.9);
      color: #b7c8e1;
      font-size: 12px;
      font-family: Consolas, "Courier New", monospace;
      user-select: none;
    }
    .graph-shell {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(280px, 1fr);
      gap: 12px;
    }
    .graph-board {
      position: relative;
      min-height: 540px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background:
        radial-gradient(circle at 1px 1px, rgba(159, 176, 203, 0.34) 1px, transparent 0),
        linear-gradient(180deg, rgba(10, 18, 34, 0.88), rgba(7, 13, 26, 0.92));
      background-size: 22px 22px, 100% 100%;
      overflow: auto;
    }
    .graph-board.panning,
    .graph-board.panning * {
      cursor: grabbing !important;
      user-select: none;
    }
    .graph-edges {
      position: absolute;
      left: 0;
      top: 0;
      pointer-events: none;
      overflow: visible;
      z-index: 1;
    }
    .graph-nodes {
      position: absolute;
      inset: 0;
      z-index: 2;
    }
    .graph-node {
      position: absolute;
      width: 220px;
      border: 1px solid #2d3e64;
      border-radius: 10px;
      background: rgba(16, 26, 44, 0.95);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.34);
      padding: 10px;
      cursor: grab;
      user-select: none;
      transition: border-color .15s ease, transform .12s ease, box-shadow .15s ease;
    }
    .graph-node:hover {
      border-color: rgba(35, 197, 143, 0.82);
      transform: translateY(-1px);
    }
    .graph-node.dragging {
      cursor: grabbing;
      z-index: 7;
      box-shadow: 0 20px 38px rgba(0, 0, 0, 0.48);
    }
    .graph-node.selected {
      border-color: rgba(35, 197, 143, 0.95);
      box-shadow: 0 0 0 2px rgba(35, 197, 143, 0.24), 0 20px 34px rgba(0, 0, 0, 0.46);
    }
    .graph-node.runtime-active {
      border-color: rgba(247, 201, 72, 0.94);
      box-shadow: 0 0 0 2px rgba(247, 201, 72, 0.24), 0 20px 34px rgba(0, 0, 0, 0.46);
    }
    .graph-node.disabled {
      opacity: 0.45;
      border-style: dashed;
    }
    .graph-node-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }
    .graph-node-title {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.25;
    }
    .graph-node-group {
      font-size: 11px;
      padding: 2px 8px;
      border: 1px solid #35558f;
      border-radius: 999px;
      color: #9bc3ff;
      background: rgba(53, 85, 143, 0.18);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .graph-node-desc {
      font-size: 12px;
      line-height: 1.4;
      color: var(--muted);
      min-height: 36px;
    }
    .graph-node-badges {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .graph-chip {
      font-size: 11px;
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(42, 56, 88, 0.9);
      background: rgba(9, 16, 30, 0.85);
      color: #b4c4de;
    }
    .graph-inspector {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(10, 18, 34, 0.76);
      padding: 12px;
      min-height: 540px;
    }
    .inspector-title {
      margin: 0;
      font-size: 16px;
    }
    .inspector-muted {
      color: var(--muted);
      font-size: 13px;
      margin-top: 4px;
      line-height: 1.45;
    }
    .inspector-list {
      margin: 10px 0 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .inspector-list li {
      margin-bottom: 4px;
      word-break: break-all;
    }
    .graph-editor {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(42, 56, 88, 0.8);
    }
    .graph-editor h4 {
      margin: 10px 0 8px;
      font-size: 13px;
      color: #b7c8e1;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }
    .graph-editor .field {
      margin-bottom: 8px;
      gap: 4px;
    }
    .graph-editor textarea {
      min-height: 66px;
      resize: vertical;
    }
    .graph-editor .inline-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .graph-editor .tiny {
      font-size: 12px;
      color: var(--muted);
    }
    .edge-path {
      fill: none;
      stroke: rgba(154, 178, 211, 0.65);
      stroke-width: 2.1;
    }
    .edge-path.edge-conditional {
      stroke-dasharray: 6 5;
    }
    .edge-path.edge-disabled {
      stroke: rgba(93, 107, 132, 0.5);
    }
    .edge-path.edge-runtime {
      stroke: rgba(247, 201, 72, 0.95);
      stroke-width: 2.8;
    }
    .edge-label {
      fill: #b9cadf;
      font-size: 11px;
      text-anchor: middle;
      paint-order: stroke;
      stroke: rgba(7, 13, 26, 0.9);
      stroke-width: 3px;
      stroke-linejoin: round;
    }
    .ide-shell {
      display: grid;
      grid-template-columns: 250px minmax(760px, 2fr) minmax(380px, 1.2fr);
      gap: 12px;
      margin-top: 10px;
    }
    .ide-pane {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(9, 16, 30, 0.82);
      padding: 10px;
      min-height: 680px;
    }
    .ide-pane-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--ink);
    }
    .file-tree {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(5, 10, 20, 0.75);
      min-height: 530px;
      max-height: 530px;
      overflow: auto;
      padding: 8px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
    }
    .tree-row {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 6px;
      cursor: pointer;
      color: #c8d7ed;
      white-space: nowrap;
    }
    .tree-row:hover {
      background: rgba(53, 85, 143, 0.2);
    }
    .tree-row.selected {
      background: rgba(35, 197, 143, 0.16);
      border: 1px solid rgba(35, 197, 143, 0.42);
    }
    .tree-indent {
      display: inline-block;
      width: var(--indent-width, 0px);
      min-width: var(--indent-width, 0px);
    }
    .tree-toggle {
      display: inline-block;
      width: 14px;
      text-align: center;
      color: #8fb0e3;
      font-size: 11px;
    }
    .tree-icon {
      width: 16px;
      text-align: center;
      color: #aac2e8;
    }
    .tree-name {
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .editor-toolbar {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto auto auto;
      gap: 8px;
      margin-bottom: 8px;
    }
    .editor-host {
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: var(--mono-bg);
      min-height: 640px;
      max-height: 640px;
    }
    .code-editor {
      width: 100%;
      min-height: 640px;
      max-height: 640px;
      height: 640px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 13px;
      line-height: 1.45;
      border: none;
      border-radius: 0;
      resize: none;
      background: transparent;
    }
    .editor-host.monaco-ready #ide-editor {
      display: none;
    }
    #ide-editor-monaco {
      display: none;
    }
    .editor-host.monaco-ready #ide-editor-monaco {
      display: block;
    }
    .editor-indicators {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 6px 0 8px;
    }
    .editor-chip {
      font-size: 12px;
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(42, 56, 88, 0.95);
      background: rgba(7, 13, 26, 0.9);
      color: #b7c8e1;
    }
    .editor-chip.lang {
      border-color: rgba(53, 133, 245, 0.55);
      color: #9fc4ff;
      background: rgba(53, 133, 245, 0.16);
    }
    .editor-chip.saved {
      border-color: rgba(35, 197, 143, 0.55);
      color: #b9f4df;
      background: rgba(35, 197, 143, 0.14);
    }
    .editor-chip.unsaved {
      border-color: rgba(224, 86, 103, 0.6);
      color: #ffc0c8;
      background: rgba(224, 86, 103, 0.14);
    }
    .runtime-box {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(5, 10, 20, 0.86);
      min-height: 150px;
      max-height: 220px;
      overflow: auto;
      padding: 10px;
      margin: 6px 0;
      color: #c8d7ed;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
      line-height: 1.45;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .runtime-log {
      min-height: 230px;
      max-height: 300px;
    }
    .tool-section {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(6, 11, 22, 0.55);
      padding: 8px;
      margin-top: 10px;
    }
    .tool-section .grid {
      margin-top: 8px;
    }
    .tool-section textarea {
      min-height: 90px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
    }
    .search-results {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(5, 10, 20, 0.82);
      min-height: 120px;
      max-height: 280px;
      overflow: auto;
      padding: 8px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
      line-height: 1.4;
    }
    .search-result-item {
      width: 100%;
      text-align: left;
      border: 1px solid transparent;
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 6px;
      background: rgba(7, 13, 26, 0.8);
      color: #c8d7ed;
      cursor: pointer;
    }
    .search-result-item:hover {
      border-color: rgba(53, 133, 245, 0.62);
    }
    .search-result-item small {
      display: block;
      color: var(--muted);
      margin: 2px 0 4px;
    }
    .tool-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    .tool-toolbar label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #c8d7ed;
    }
    .tool-toolbar select,
    .tool-toolbar input[type="number"] {
      width: auto;
      min-width: 80px;
    }
    .obs-shell {
      display: grid;
      grid-template-columns: minmax(320px, 1fr) minmax(360px, 1.4fr);
      gap: 12px;
      margin-top: 10px;
    }
    .obs-pane {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(9, 16, 30, 0.82);
      padding: 10px;
      min-height: 560px;
    }
    .obs-pane .runtime-box {
      min-height: 120px;
      max-height: 240px;
    }
    .trace-list {
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(5, 10, 20, 0.82);
      min-height: 200px;
      max-height: 280px;
      overflow: auto;
      padding: 8px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
      line-height: 1.4;
    }
    .trace-item {
      border: 1px solid transparent;
      border-radius: 8px;
      padding: 6px 8px;
      cursor: pointer;
      margin-bottom: 6px;
      background: rgba(7, 13, 26, 0.7);
    }
    .trace-item:hover {
      border-color: rgba(53, 133, 245, 0.52);
    }
    .trace-item.active {
      border-color: rgba(35, 197, 143, 0.72);
      background: rgba(35, 197, 143, 0.14);
    }
    .trace-item small {
      display: block;
      color: var(--muted);
      margin-top: 3px;
    }
    .scenario-shell {
      display: grid;
      grid-template-columns: minmax(280px, 0.9fr) minmax(420px, 1.5fr);
      gap: 12px;
      margin-top: 10px;
    }
    .scenario-pane {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(9, 16, 30, 0.82);
      padding: 10px;
      min-height: 560px;
    }
    .scenario-pane textarea {
      min-height: 110px;
    }
    .scenario-pane textarea.mono {
      min-height: 160px;
    }
    .history-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto auto;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .inspector-file-btn {
      width: 100%;
      text-align: left;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: rgba(6, 11, 22, 0.7);
      color: #c8d7ed;
      padding: 6px 8px;
      font-family: Consolas, "Courier New", monospace;
      font-size: 12px;
      cursor: pointer;
    }
    .inspector-file-btn:hover {
      border-color: rgba(35, 197, 143, 0.55);
    }
    .inspector-list li {
      list-style: none;
      margin-left: -18px;
    }
    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
      textarea.mono { min-height: 280px; }
      .graph-shell { grid-template-columns: 1fr; }
      .graph-board { min-height: 460px; }
      .graph-inspector { min-height: auto; }
      .ide-shell { grid-template-columns: 1fr; }
      .ide-pane { min-height: auto; }
      .obs-shell { grid-template-columns: 1fr; }
      .obs-pane { min-height: auto; }
      .scenario-shell { grid-template-columns: 1fr; }
      .scenario-pane { min-height: auto; }
      .file-tree { min-height: 300px; max-height: 340px; }
      .editor-host { min-height: 420px; max-height: 460px; }
      .code-editor { min-height: 420px; max-height: 460px; height: 460px; }
      .editor-toolbar { grid-template-columns: 1fr 1fr; }
      .history-row { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>REG-01 Developer Console</h1>
      <p>เครื่องมือ dev-only สำหรับปรับ flow และแก้ค่า environment โดยไม่ปนกับหน้า admin</p>
      <div class="badge">LOCAL ONLY: หน้าและ API ของ dev จะเข้าได้เฉพาะ localhost</div>
    </div>

    <div class="layout">
      <div class="card">
        <h2>Dev Authentication</h2>
        <div class="grid">
          <div class="field full">
            <label for="dev-token">X-Dev-Token</label>
            <input id="dev-token" type="password" placeholder="ใส่ DEV_TOKEN" />
          </div>
        </div>
        <div class="row">
          <button id="connect-btn" class="primary">Connect</button>
          <button id="load-btn">Reload Flow</button>
        </div>
        <div id="auth-status" class="status"></div>
      </div>

      <div class="card tabs-card">
        <div class="tabs-nav" role="tablist" aria-label="Developer Sections">
          <button type="button" class="tab-btn active" data-dev-tab-btn="flow-config" aria-selected="true">Flow Config</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="flow-graph" aria-selected="false">Flow Graph</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="observability" aria-selected="false">Observability</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="scenarios" aria-selected="false">Scenarios</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="workspace" aria-selected="false">Dev Workspace</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="environment" aria-selected="false">Environment</button>
          <button type="button" class="tab-btn" data-dev-tab-btn="test-run" aria-selected="false">Test Run</button>
        </div>
      </div>

      <div class="card tab-panel active" data-dev-tab-panel="flow-config">
        <h2>Flow Config (Active/Draft)</h2>
        <div class="grid">
          <div class="field">
            <label for="rag-mode">RAG Mode</label>
            <select id="rag-mode">
              <option value="keyword">keyword (ใช้ query_request)</option>
              <option value="always">always (ทุกคำถาม)</option>
              <option value="never">never (ปิด RAG)</option>
            </select>
          </div>
          <div class="field">
            <label for="rag-top-k">RAG top_k (1-20)</label>
            <input id="rag-top-k" type="number" min="1" max="20" />
          </div>
          <div class="field">
            <label><input id="rag-hybrid" type="checkbox" /> use_hybrid</label>
          </div>
          <div class="field">
            <label><input id="rag-intent" type="checkbox" /> use_intent_analysis</label>
          </div>
          <div class="field">
            <label><input id="rag-rerank" type="checkbox" /> use_llm_rerank</label>
          </div>
          <div class="field">
            <label><input id="memory-summary" type="checkbox" /> enable_summary</label>
          </div>
          <div class="field">
            <label for="memory-recent">recent_messages (1-30)</label>
            <input id="memory-recent" type="number" min="1" max="30" />
          </div>
          <div class="field">
            <label><input id="pose-enabled" type="checkbox" /> pose_enabled</label>
          </div>
          <div class="field">
            <label><input id="faq-auto-learn" type="checkbox" /> faq_auto_learn</label>
          </div>
          <div class="field full">
            <label for="extra-instruction">extra_context_instruction</label>
            <textarea id="extra-instruction" placeholder="คำสั่งเพิ่มสำหรับนักพัฒนา (ต่อท้าย prompt)"></textarea>
          </div>
        </div>
        <div class="row">
          <button id="save-btn" class="primary">Save Active Flow</button>
        </div>
        <div class="history-row">
          <select id="flow-history-select"></select>
          <button id="flow-history-load-btn">Load History</button>
          <button id="flow-rollback-btn" class="danger">Rollback</button>
        </div>
        <div id="flow-status" class="status"></div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="flow-graph">
        <h2>Flow Graph</h2>
        <p>มุมมองการเชื่อมต่อ pipeline แบบ visual สำหรับ dev เพื่อดูเส้นทาง runtime และลอง preview จาก draft config ก่อน save</p>
        <div class="graph-toolbar">
          <button id="graph-load-btn">Reload Graph</button>
          <button id="graph-preview-btn" class="primary">Preview Draft Graph</button>
          <button id="graph-model-load-btn">Load Model</button>
          <button id="graph-model-save-btn" class="primary">Save Model</button>
          <button id="graph-model-reset-btn" class="danger">Reset Model</button>
          <button id="graph-layout-btn">Auto Layout</button>
          <span class="graph-spacer"></span>
          <button id="graph-zoom-out-btn">-</button>
          <button id="graph-zoom-reset-btn">100%</button>
          <button id="graph-zoom-in-btn">+</button>
          <span id="graph-zoom-indicator" class="graph-zoom-badge">Zoom 100%</span>
        </div>
        <div class="hint" style="margin-top: 0;">Ctrl + Wheel = Zoom, Wheel = Scroll, Middle Mouse (or Alt + Drag) = Pan</div>
        <div class="history-row" style="margin-top: 8px;">
          <select id="graph-history-select"></select>
          <button id="graph-history-load-btn">Load History</button>
          <button id="graph-rollback-btn" class="danger">Rollback</button>
        </div>
        <div class="graph-shell">
          <div class="graph-board" id="graph-board">
            <svg id="graph-edges" class="graph-edges"></svg>
            <div id="graph-nodes" class="graph-nodes"></div>
          </div>
          <div class="graph-inspector">
            <h3 id="inspector-title" class="inspector-title">Node Inspector</h3>
            <div id="inspector-desc" class="inspector-muted">คลิก node ในกราฟเพื่อดูรายละเอียด</div>
            <div id="inspector-badges" class="graph-node-badges" style="margin-top: 10px;"></div>
            <div class="hint" style="margin-top: 12px;">Code files</div>
            <ul id="inspector-files" class="inspector-list"></ul>

            <div class="graph-editor">
              <h4>Node Editor</h4>
              <div class="field">
                <label for="graph-node-id">node id</label>
                <input id="graph-node-id" type="text" placeholder="example_node" />
              </div>
              <div class="field">
                <label for="graph-node-title">title</label>
                <input id="graph-node-title" type="text" />
              </div>
              <div class="inline-row">
                <div class="field">
                  <label for="graph-node-group">group</label>
                  <input id="graph-node-group" type="text" />
                </div>
                <div class="field">
                  <label for="graph-node-enabled"><input id="graph-node-enabled" type="checkbox" /> enabled</label>
                </div>
              </div>
              <div class="inline-row">
                <div class="field">
                  <label for="graph-node-lane">lane</label>
                  <input id="graph-node-lane" type="number" min="0" max="40" />
                </div>
                <div class="field">
                  <label for="graph-node-order">order</label>
                  <input id="graph-node-order" type="number" min="0" max="40" />
                </div>
              </div>
              <div class="field">
                <label for="graph-node-description">description</label>
                <textarea id="graph-node-description"></textarea>
              </div>
              <div class="field">
                <label for="graph-node-badges">badges (comma separated)</label>
                <input id="graph-node-badges" type="text" placeholder="badge1,badge2" />
              </div>
              <div class="field">
                <label for="graph-node-files">file refs (1 line each)</label>
                <textarea id="graph-node-files" placeholder="backend/router/chat_router.py"></textarea>
              </div>
              <div class="row" style="margin-top: 6px;">
                <button id="graph-node-new-btn">New Node</button>
                <button id="graph-node-apply-btn" class="primary">Apply Node</button>
                <button id="graph-node-delete-btn" class="danger">Delete Node</button>
              </div>

              <h4>Edge Editor</h4>
              <div class="field">
                <label for="graph-edge-select">edge select</label>
                <select id="graph-edge-select"></select>
              </div>
              <div class="field">
                <label for="graph-edge-id">edge id</label>
                <input id="graph-edge-id" type="text" placeholder="edge_id" />
              </div>
              <div class="inline-row">
                <div class="field">
                  <label for="graph-edge-source">source</label>
                  <input id="graph-edge-source" type="text" />
                </div>
                <div class="field">
                  <label for="graph-edge-target">target</label>
                  <input id="graph-edge-target" type="text" />
                </div>
              </div>
              <div class="field">
                <label for="graph-edge-label">label</label>
                <input id="graph-edge-label" type="text" />
              </div>
              <div class="inline-row">
                <div class="field">
                  <label><input id="graph-edge-enabled" type="checkbox" /> enabled</label>
                </div>
                <div class="field">
                  <label><input id="graph-edge-conditional" type="checkbox" /> conditional</label>
                </div>
              </div>
              <div class="row" style="margin-top: 6px;">
                <button id="graph-edge-new-btn">New Edge</button>
                <button id="graph-edge-apply-btn" class="primary">Apply Edge</button>
                <button id="graph-edge-delete-btn" class="danger">Delete Edge</button>
              </div>
              <div class="tiny">Tip: source/target must match existing node id</div>
            </div>
          </div>
        </div>
        <div id="graph-status" class="status"></div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="observability">
        <h2>Observability</h2>
        <div class="obs-shell">
          <div class="obs-pane">
            <div class="ide-pane-head">
              <strong>Trace Explorer</strong>
              <button id="trace-refresh-btn">Refresh</button>
            </div>
            <div class="grid">
              <div class="field">
                <label for="trace-session-filter">Session Filter</label>
                <input id="trace-session-filter" type="text" placeholder="session_id" />
              </div>
              <div class="field">
                <label for="trace-status-filter">Status</label>
                <select id="trace-status-filter">
                  <option value="">all</option>
                  <option value="ok">ok</option>
                  <option value="error">error</option>
                </select>
              </div>
            </div>
            <div class="tool-toolbar">
              <label for="monitor-interval">interval(s)
                <input id="monitor-interval" type="number" min="2" max="120" value="10" />
              </label>
              <label><input id="monitor-auto-traces" type="checkbox" checked /> traces</label>
              <label><input id="monitor-auto-log-search" type="checkbox" checked /> log search</label>
              <label><input id="monitor-auto-runtime-log" type="checkbox" /> runtime log</label>
              <label><input id="monitor-auto-runtime-summary" type="checkbox" /> runtime summary</label>
              <button id="monitor-start-btn">Start Auto Refresh</button>
              <button id="monitor-stop-btn">Stop</button>
            </div>
            <div id="monitor-status" class="status"></div>
            <div id="trace-list" class="trace-list"></div>
            <div class="row">
              <button id="trace-apply-graph-btn" class="primary">Highlight On Graph</button>
              <button id="trace-clear-graph-btn">Clear Highlight</button>
            </div>
            <div id="trace-meta" class="status"></div>
            <div class="hint">Trace Steps</div>
            <pre id="trace-steps" class="runtime-box"></pre>
            <div class="hint">Trace Detail</div>
            <pre id="trace-data" class="runtime-box"></pre>
          </div>
          <div class="obs-pane">
            <div class="tool-section" style="margin-top: 0;">
              <div class="ide-pane-head">
                <strong>Connection Map</strong>
                <button id="conn-refresh-btn">Refresh</button>
              </div>
              <pre id="conn-output" class="runtime-box"></pre>
            </div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>Route Map</strong>
                <button id="route-refresh-btn">Refresh</button>
              </div>
              <div class="field">
                <label for="route-filter">Filter</label>
                <input id="route-filter" type="text" placeholder="path, method, tag, endpoint" />
              </div>
              <pre id="route-output" class="runtime-box runtime-log"></pre>
            </div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>API Probe</strong>
                <button id="probe-send-btn" class="primary">Send</button>
              </div>
              <div class="grid">
                <div class="field">
                  <label for="probe-method">Method</label>
                  <select id="probe-method">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="PATCH">PATCH</option>
                    <option value="DELETE">DELETE</option>
                  </select>
                </div>
                <div class="field">
                  <label for="probe-path">Path</label>
                  <input id="probe-path" type="text" value="/api/dev/runtime/summary" />
                </div>
                <div class="field full">
                  <label for="probe-query">Query JSON</label>
                  <textarea id="probe-query">{}</textarea>
                </div>
                <div class="field full">
                  <label for="probe-headers">Headers JSON</label>
                  <textarea id="probe-headers">{}</textarea>
                </div>
                <div class="field full">
                  <label for="probe-body">Body (JSON or text)</label>
                  <textarea id="probe-body"></textarea>
                </div>
              </div>
              <div id="probe-status" class="status"></div>
              <pre id="probe-output" class="runtime-box runtime-log"></pre>
            </div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>Log Search</strong>
                <button id="log-search-btn" class="primary">Search</button>
              </div>
              <div class="grid">
                <div class="field">
                  <label for="log-search-path">Path</label>
                  <input id="log-search-path" type="text" value="logs/user_audit.log" />
                </div>
                <div class="field">
                  <label for="log-search-contains">Contains</label>
                  <input id="log-search-contains" type="text" placeholder="keyword" />
                </div>
                <div class="field">
                  <label for="log-search-platform">Platform</label>
                  <select id="log-search-platform">
                    <option value="">all</option>
                    <option value="web">web</option>
                    <option value="facebook">facebook</option>
                  </select>
                </div>
                <div class="field">
                  <label for="log-search-trace">Trace ID</label>
                  <input id="log-search-trace" type="text" placeholder="trace_id" />
                </div>
                <div class="field full">
                  <label for="log-search-session">Session ID</label>
                  <input id="log-search-session" type="text" placeholder="session_id" />
                </div>
              </div>
              <div id="log-search-status" class="status"></div>
              <pre id="log-search-output" class="runtime-box runtime-log"></pre>
            </div>
          </div>
        </div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="scenarios">
        <h2>Scenarios + Replay</h2>
        <div class="scenario-shell">
          <div class="scenario-pane">
            <div class="ide-pane-head">
              <strong>Scenario List</strong>
              <button id="scenario-refresh-btn">Refresh</button>
            </div>
            <div class="field">
              <label for="scenario-select">Scenario</label>
              <select id="scenario-select"></select>
            </div>
            <div class="row">
              <button id="scenario-new-btn">New</button>
              <button id="scenario-load-btn">Load</button>
              <button id="scenario-delete-btn" class="danger">Delete</button>
            </div>
            <div id="scenario-status" class="status"></div>
            <div class="hint">Last Run Output</div>
            <pre id="scenario-run-output" class="runtime-box runtime-log"></pre>
            <div id="scenario-run-meta" class="status"></div>
          </div>
          <div class="scenario-pane">
            <div class="grid">
              <div class="field">
                <label for="scenario-id">id</label>
                <input id="scenario-id" type="text" placeholder="scenario_id (optional)" />
              </div>
              <div class="field">
                <label for="scenario-name">name</label>
                <input id="scenario-name" type="text" placeholder="Scenario Name" />
              </div>
              <div class="field full">
                <label for="scenario-description">description</label>
                <textarea id="scenario-description"></textarea>
              </div>
              <div class="field full">
                <label for="scenario-message">message</label>
                <textarea id="scenario-message"></textarea>
              </div>
              <div class="field full">
                <label for="scenario-config">config_override (JSON)</label>
                <textarea id="scenario-config" class="mono">{}</textarea>
              </div>
            </div>
            <div class="row">
              <button id="scenario-save-btn" class="primary">Save Scenario</button>
              <button id="scenario-run-btn" class="primary">Run Scenario</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="workspace">
        <h2>Dev Workspace</h2>
        <p>จัดการไฟล์ backend/frontend, เปิดแก้ไขโค้ด, และดู runtime/logs ได้จากหน้า dev โดยตรง (local-only)</p>
        <div class="ide-shell">
          <div class="ide-pane">
            <div class="ide-pane-head">
              <strong>Explorer</strong>
            </div>
            <div class="row" style="margin-top: 0;">
              <button id="ide-root-btn">Root</button>
              <button id="ide-up-btn">Up</button>
              <button id="ide-refresh-tree-btn">Refresh</button>
            </div>
            <div id="ide-tree-status" class="hint"></div>
            <div id="ide-tree" class="file-tree"></div>
          </div>

          <div class="ide-pane">
            <div class="editor-toolbar">
              <input id="ide-open-path" type="text" placeholder="workspace relative path, e.g. backend/router/dev_router.py" />
              <button id="ide-open-btn">Open</button>
              <button id="ide-reload-btn">Reload</button>
              <button id="ide-save-btn" class="primary">Save</button>
            </div>
            <div id="ide-editor-meta" class="hint">No file opened</div>
            <div class="editor-indicators">
              <span id="ide-lang-badge" class="editor-chip lang">plaintext</span>
              <span id="ide-cursor-pos" class="editor-chip">Ln 1, Col 1</span>
              <span id="ide-dirty-badge" class="editor-chip saved">Saved</span>
            </div>
            <div id="ide-editor-host" class="editor-host">
              <div id="ide-editor-monaco" class="code-editor"></div>
              <textarea id="ide-editor" class="mono code-editor" spellcheck="false" placeholder="// Open file from explorer to edit code"></textarea>
            </div>
            <div id="ide-editor-status" class="status"></div>
          </div>

          <div class="ide-pane">
            <div class="ide-pane-head">
              <strong>Runtime Monitor</strong>
              <button id="ide-runtime-refresh-btn">Refresh</button>
            </div>
            <div class="hint">Runtime Summary</div>
            <pre id="ide-runtime-summary" class="runtime-box"></pre>
            <div class="row" style="margin-top: 8px;">
              <input id="ide-log-path" type="text" value="logs/user_audit.log" />
              <button id="ide-log-refresh-btn">Tail</button>
            </div>
            <div class="hint">Log Tail</div>
            <pre id="ide-runtime-log" class="runtime-box runtime-log"></pre>
            <div id="ide-runtime-status" class="status"></div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>Workspace Search</strong>
                <button id="ide-search-btn">Search</button>
              </div>
              <div class="grid">
                <div class="field full">
                  <label for="ide-search-query">Query</label>
                  <input id="ide-search-query" type="text" placeholder="search text or regex pattern" />
                </div>
                <div class="field">
                  <label for="ide-search-path">Path Scope</label>
                  <input id="ide-search-path" type="text" value="backend" />
                </div>
                <div class="field">
                  <label><input id="ide-search-case" type="checkbox" /> case sensitive</label>
                </div>
                <div class="field">
                  <label><input id="ide-search-regex" type="checkbox" /> regex</label>
                </div>
              </div>
              <div id="ide-search-status" class="status"></div>
              <div id="ide-search-results" class="search-results"></div>
            </div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>Symbol Tools</strong>
                <button id="symbol-find-btn">Find Symbol</button>
              </div>
              <div class="grid">
                <div class="field">
                  <label for="symbol-name">Symbol</label>
                  <input id="symbol-name" type="text" placeholder="function_name / class_name / variable" />
                </div>
                <div class="field">
                  <label for="symbol-path">Path Scope</label>
                  <input id="symbol-path" type="text" value="backend" />
                </div>
                <div class="field">
                  <label><input id="symbol-case" type="checkbox" checked /> case sensitive</label>
                </div>
              </div>
              <div id="symbol-status" class="status"></div>
              <div id="symbol-results" class="search-results"></div>
            </div>

            <div class="tool-section">
              <div class="ide-pane-head">
                <strong>Command Runner</strong>
                <button id="shell-run-btn" class="primary">Run</button>
              </div>
              <div class="row" style="margin-top: 0;">
                <select id="shell-preset">
                  <option value="">-- presets --</option>
                  <option value="python -m compileall backend">python -m compileall backend</option>
                  <option value="python -m pytest -q">python -m pytest -q</option>
                  <option value="python run.py">python run.py</option>
                  <option value="rg -n \"TODO|FIXME\" backend frontend">rg -n "TODO|FIXME" backend frontend</option>
                  <option value="git status --short">git status --short</option>
                </select>
                <button id="shell-history-clear-btn">Clear History</button>
              </div>
              <div class="grid">
                <div class="field">
                  <label for="shell-cwd">Working Dir</label>
                  <input id="shell-cwd" type="text" value="" placeholder="workspace root if empty" />
                </div>
                <div class="field">
                  <label for="shell-timeout">Timeout (sec)</label>
                  <input id="shell-timeout" type="number" min="1" max="120" value="25" />
                </div>
                <div class="field full">
                  <label for="shell-command">Command</label>
                  <textarea id="shell-command" placeholder="e.g. python -m pytest -q"></textarea>
                </div>
              </div>
              <div id="shell-status" class="status"></div>
              <pre id="shell-output" class="runtime-box runtime-log"></pre>
              <div class="hint">Recent Commands</div>
              <div id="shell-history" class="search-results"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="environment">
        <h2>Environment (.env)</h2>
        <p>แก้ไฟล์ `.env` ได้ทั้งไฟล์โดยตรงจากหน้านี้</p>
        <div class="row">
          <button id="env-load-btn">Load .env</button>
          <button id="env-save-btn" class="primary">Save .env</button>
        </div>
        <div class="history-row">
          <select id="env-history-select"></select>
          <button id="env-history-load-btn">Load History</button>
          <button id="env-rollback-btn" class="danger">Rollback</button>
        </div>
        <div class="hint">เมื่อบันทึก ระบบจะสร้างไฟล์สำรอง `.env.bak` อัตโนมัติ และ reload ค่า env ใน process ปัจจุบัน</div>
        <div class="field full" style="margin-top: 10px;">
          <label for="env-raw">backend/.env</label>
          <textarea id="env-raw" class="mono" spellcheck="false"></textarea>
        </div>
        <div id="env-status" class="status"></div>
      </div>

      <div class="card tab-panel" data-dev-tab-panel="test-run">
        <h2>Test Run (Draft Config)</h2>
        <div class="grid">
          <div class="field full">
            <label for="test-message">Message</label>
            <textarea id="test-message" placeholder="พิมพ์คำถามเพื่อทดสอบ flow ปัจจุบัน"></textarea>
          </div>
        </div>
        <div class="row">
          <button id="test-btn" class="primary">Run Test</button>
          <button id="clear-btn" class="danger">Clear Output</button>
        </div>
        <div id="test-meta" class="status"></div>
        <div id="test-output" class="output"></div>
      </div>
    </div>
  </div>

  <script src="/static/js/dev-console.js"></script>
</body>
</html>
