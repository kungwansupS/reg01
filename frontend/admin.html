<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal | REG CMU Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/adminstyle.css" />
</head>
<body x-data="adminApp()" x-init="init()" :class="{ 'dark-mode': settings.darkMode }">

    <template x-if="!isLoggedIn">
        <div class="login-container fixed inset-0 z-[1000] flex items-center justify-center p-4">
            <div class="card-enterprise p-8 md:p-12 rounded-3xl shadow-2xl w-full max-w-md relative z-10 animate-in">
                <div class="text-center mb-8">
                    <div class="gradient-cmu w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                        <i data-lucide="shield-check" class="text-white w-10 h-10"></i>
                    </div>
                    <h2 class="text-3xl md:text-4xl font-black gradient-text-cmu mb-2">Enterprise Portal</h2>
                    <p class="text-sm md:text-base font-medium" style="color: var(--text-secondary);">REG CMU Platform</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold mb-2" style="color: var(--text-secondary);">Security Token</label>
                        <input 
                            type="password" 
                            x-model="tokenInput" 
                            @keyup.enter="login()" 
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            class="w-full px-4 py-3 rounded-xl border-2 focus:ring-0 text-center font-bold tracking-widest">
                    </div>
                    <button 
                        @click="login()" 
                        class="w-full gradient-cmu text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl btn-enterprise flex items-center justify-center gap-2">
                        <span>Authenticate</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </template>

    <div 
        x-show="isLoggedIn && mobileMenuOpen" 
        @click="mobileMenuOpen = false" 
        class="mobile-overlay md:hidden"
        x-cloak>
    </div>

    <div x-show="isLoggedIn" x-cloak class="flex h-screen overflow-hidden">
        
        <aside 
            class="sidebar w-72 card-enterprise h-screen flex flex-col border-r shadow-lg"
            :class="{ 'open': mobileMenuOpen }"
            style="border-color: var(--border-primary);">
            
            <div class="p-6 border-b" style="border-color: var(--border-secondary);">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="gradient-cmu p-2.5 rounded-xl shadow-lg">
                            <i data-lucide="brain-circuit" class="text-white w-6 h-6"></i>
                        </div>
                        <div>
                            <span class="font-black text-xl tracking-tight gradient-text-cmu block">REG CMU</span>
                            <p class="text-xs font-medium" style="color: var(--text-tertiary);">Admin Console</p>
                        </div>
                    </div>
                    <button 
                        @click="mobileMenuOpen = false" 
                        class="md:hidden p-2 hover:bg-opacity-10 rounded-lg"
                        style="color: var(--text-secondary);">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <nav class="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                <button 
                    @click="switchTab('dashboard')" 
                    :class="activeTab === 'dashboard' ? 'active' : ''"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    :style="activeTab === 'dashboard' ? 'background-color: var(--bg-tertiary); color: var(--cmu-purple);' : 'color: var(--text-secondary);'">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </button>

                <button 
                    @click="switchTab('chat')" 
                    :class="activeTab === 'chat' ? 'active' : ''"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    :style="activeTab === 'chat' ? 'background-color: var(--bg-tertiary); color: var(--cmu-purple);' : 'color: var(--text-secondary);'">
                    <i data-lucide="message-square" class="w-5 h-5"></i>
                    <span>Unified Chat</span>
                </button>
                
                <button 
                    @click="switchTab('files')" 
                    :class="activeTab === 'files' ? 'active' : ''"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    :style="activeTab === 'files' ? 'background-color: var(--bg-tertiary); color: var(--cmu-purple);' : 'color: var(--text-secondary);'">
                    <i data-lucide="folder-open" class="w-5 h-5"></i>
                    <span>File Explorer</span>
                </button>
                
                <button 
                    @click="switchTab('logs')" 
                    :class="activeTab === 'logs' ? 'active' : ''"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    :style="activeTab === 'logs' ? 'background-color: var(--bg-tertiary); color: var(--cmu-purple);' : 'color: var(--text-secondary);'">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                    <span>Audit Logs</span>
                </button>
                
                <button 
                    @click="switchTab('database')" 
                    :class="activeTab === 'database' ? 'active' : ''"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    :style="activeTab === 'database' ? 'background-color: var(--bg-tertiary); color: var(--cmu-purple);' : 'color: var(--text-secondary);'">
                    <i data-lucide="database" class="w-5 h-5"></i>
                    <span>Database</span>
                </button>
            </nav>

            <div class="p-4 border-t space-y-1" style="border-color: var(--border-secondary);">
                <button 
                    @click="settings.darkMode = !settings.darkMode" 
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all hover:bg-opacity-10"
                    style="color: var(--text-secondary);">
                    <i :data-lucide="settings.darkMode ? 'sun' : 'moon'" class="w-5 h-5"></i>
                    <span x-text="settings.darkMode ? 'Light Mode' : 'Dark Mode'"></span>
                </button>
                <button 
                    @click="logout()" 
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all"
                    style="color: var(--danger);">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    <span>Sign Out</span>
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto custom-scrollbar">
            <div class="md:hidden card-enterprise p-4 border-b sticky top-0 z-50 flex items-center justify-between"
                 style="border-color: var(--border-primary);">
                <button 
                    @click="mobileMenuOpen = true" 
                    class="p-2 rounded-lg"
                    style="color: var(--text-primary);">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <span class="font-black gradient-text-cmu">REG CMU</span>
                <div class="w-10"></div>
            </div>

            <div class="p-6 md:p-10 h-full flex flex-col">
                
                <div x-show="activeTab === 'dashboard'" x-cloak class="animate-in">
                    <div class="mb-8">
                        <h1 class="text-4xl md:text-5xl font-black gradient-text-cmu mb-2">Dashboard</h1>
                        <p class="font-medium" style="color: var(--text-secondary);">System Overview & Real-time Analytics</p>
                    </div>

                    <!-- Date & Time Display -->
                    <div class="card-enterprise stat-card p-6 md:p-8 rounded-2xl shadow-lg mb-8">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                            <div>
                                <p class="text-xs font-bold uppercase tracking-wider mb-2" style="color: var(--text-tertiary);">Current Time</p>
                                <div class="clock-display text-3xl md:text-4xl font-black gradient-text-cmu" x-text="currentTime"></div>
                            </div>
                            <div>
                                <p class="text-xs font-bold uppercase tracking-wider mb-2" style="color: var(--text-tertiary);">Date</p>
                                <div class="text-xl md:text-2xl font-bold" style="color: var(--text-secondary);" x-text="currentDate"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card-enterprise stat-card p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-tertiary);">Total Activities</p>
                                <div class="p-2 rounded-lg" style="background-color: var(--bg-tertiary);">
                                    <i data-lucide="activity" class="w-5 h-5" style="color: var(--cmu-purple);"></i>
                                </div>
                            </div>
                            <h3 class="text-4xl md:text-5xl font-black" style="color: var(--text-primary);" x-text="stats.recent_logs.length">0</h3>
                            <p class="text-sm font-medium mt-2" style="color: var(--text-tertiary);">Total queries processed</p>
                        </div>

                        <div class="card-enterprise stat-card p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-tertiary);">Avg Latency</p>
                                <div class="p-2 rounded-lg" style="background-color: var(--bg-tertiary);">
                                    <i data-lucide="zap" class="w-5 h-5" style="color: var(--accent-gold);"></i>
                                </div>
                            </div>
                            <h3 class="text-4xl md:text-5xl font-black gradient-text-cmu" x-text="calculateAvgLatency() + 's'">0ms</h3>
                            <p class="text-sm font-medium mt-2" style="color: var(--text-tertiary);">Response time average</p>
                        </div>

                        <div class="card-enterprise stat-card p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-tertiary);">Active Sessions</p>
                                <div class="p-2 rounded-lg" style="background-color: var(--bg-tertiary);">
                                    <i data-lucide="users" class="w-5 h-5" style="color: var(--success);"></i>
                                </div>
                            </div>
                            <h3 class="text-4xl md:text-5xl font-black" style="color: var(--success);" x-text="getActiveSessionsCount()">0</h3>
                            <p class="text-sm font-medium mt-2" style="color: var(--text-tertiary);">Total user sessions</p>
                        </div>

                        <div class="card-enterprise stat-card p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-tertiary);">System Status</p>
                                <div class="p-2 rounded-lg" style="background-color: var(--bg-tertiary);">
                                    <i data-lucide="server" class="w-5 h-5" style="color: var(--success);"></i>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 mt-2">
                                <div class="status-indicator" style="background-color: var(--success);"></div>
                                <span class="font-black text-xl md:text-2xl" style="color: var(--success);">ONLINE</span>
                            </div>
                            <p class="text-sm font-medium mt-2" style="color: var(--text-tertiary);">All systems running</p>
                        </div>
                    </div>

                    <!-- Platform Statistics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="card-enterprise p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-lg" style="color: var(--text-primary);">Platform Usage</h3>
                                <i data-lucide="pie-chart" class="w-5 h-5" style="color: var(--text-tertiary);"></i>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Facebook</span>
                                    </div>
                                    <span class="font-black" style="color: var(--text-primary);" x-text="getPlatformCount('facebook')">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Web</span>
                                    </div>
                                    <span class="font-black" style="color: var(--text-primary);" x-text="getPlatformCount('web')">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full" style="background-color: #06C755;"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Line</span>
                                    </div>
                                    <span class="font-black" style="color: var(--text-primary);" x-text="getPlatformCount('line')">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-enterprise p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-lg" style="color: var(--text-primary);">Bot Statistics</h3>
                                <i data-lucide="bot" class="w-5 h-5" style="color: var(--text-tertiary);"></i>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Bot Enabled</span>
                                    </div>
                                    <span class="font-black text-emerald-500" x-text="getBotEnabledCount()">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full" style="background-color: var(--danger);"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Bot Disabled</span>
                                    </div>
                                    <span class="font-black" style="color: var(--danger);" x-text="getBotDisabledCount()">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-3 h-3 rounded-full" style="background-color: var(--cmu-purple);"></div>
                                        <span class="font-semibold" style="color: var(--text-secondary);">Auto Response Rate</span>
                                    </div>
                                    <span class="font-black" style="color: var(--cmu-purple);" x-text="getAutoResponseRate() + '%'">0%</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-enterprise p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-lg" style="color: var(--text-primary);">FAQ Knowledge Base</h3>
                                <i data-lucide="book-open" class="w-5 h-5" style="color: var(--text-tertiary);"></i>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="font-semibold" style="color: var(--text-secondary);">Total KB</span>
                                    <span class="font-black" style="color: var(--text-primary);" x-text="stats.faq_analytics?.total_knowledge_base || 0">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="font-semibold" style="color: var(--text-secondary);">Auto Learned</span>
                                    <span class="font-black text-blue-500" x-text="stats.faq_analytics?.auto_learned_count || 0">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="font-semibold" style="color: var(--text-secondary);">Cache Hit Rate</span>
                                    <span class="font-black text-green-500" x-text="getCacheHitRate() + '%'">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity & Top FAQs -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Recent Activity -->
                        <div class="card-enterprise p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="font-bold text-xl" style="color: var(--text-primary);">Recent Activity</h3>
                                <button @click="switchTab('logs')" class="text-sm font-bold" style="color: var(--cmu-purple);">
                                    View All ‚Üí
                                </button>
                            </div>
                            <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                                <template x-for="log in stats.recent_logs.slice(0, 8)" :key="log.timestamp + log.anon_id">
                                    <div class="p-4 rounded-xl transition-all" style="background-color: var(--bg-tertiary);">
                                        <div class="flex items-start justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <span class="badge-enterprise" 
                                                      :style="log.platform === 'web' ? 'background-color: rgba(81, 45, 109, 0.1); color: var(--cmu-purple);' : 
                                                              log.platform === 'facebook' ? 'background-color: rgba(24, 119, 242, 0.1); color: #1877F2;' : 
                                                              log.platform === 'line' ? 'background-color: rgba(6, 199, 85, 0.1); color: #06C755;' :
                                                              'background-color: var(--bg-tertiary); color: var(--text-secondary);'"
                                                      x-text="log.platform">
                                                </span>
                                                <span class="text-xs font-bold" style="color: var(--text-tertiary);" x-text="formatTime(log.timestamp)"></span>
                                            </div>
                                            <span class="badge-enterprise"
                                                :style="log.latency < 1000 ? 'background-color: rgba(52, 199, 89, 0.1); color: var(--success);' : 
                                                        log.latency < 3000 ? 'background-color: rgba(255, 149, 0, 0.1); color: var(--warning);' : 
                                                        'background-color: rgba(255, 59, 48, 0.1); color: var(--danger);'"
                                                x-text="log.latency + 's'">
                                            </span>
                                        </div>
                                        <p class="text-sm font-medium truncate" style="color: var(--text-primary);" x-text="log.input"></p>
                                        <p class="text-xs mt-1 truncate" style="color: var(--text-secondary);" x-text="log.output"></p>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Top FAQs -->
                        <div class="card-enterprise p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="font-bold text-xl" style="color: var(--text-primary);">Top FAQs</h3>
                                <i data-lucide="trending-up" class="w-5 h-5" style="color: var(--success);"></i>
                            </div>
                            <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                                <template x-if="stats.faq_analytics?.top_faqs && stats.faq_analytics.top_faqs.length > 0">
                                    <div>
                                        <template x-for="(faq, index) in stats.faq_analytics.top_faqs" :key="index">
                                            <div class="p-4 rounded-xl mb-3 transition-all" style="background-color: var(--bg-tertiary);">
                                                <div class="flex items-start justify-between mb-2">
                                                    <span class="font-black text-2xl" style="color: var(--cmu-purple);" x-text="'#' + (index + 1)"></span>
                                                    <span class="badge-enterprise bg-emerald-500/10 text-emerald-600">
                                                        <i data-lucide="eye" class="w-3 h-3"></i>
                                                        <span x-text="faq.hits + ' hits'"></span>
                                                    </span>
                                                </div>
                                                <p class="text-sm font-semibold leading-relaxed" style="color: var(--text-primary);" x-text="faq.question"></p>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                <template x-if="!stats.faq_analytics?.top_faqs || stats.faq_analytics.top_faqs.length === 0">
                                    <div class="text-center py-8">
                                        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3" style="color: var(--border-primary);"></i>
                                        <p class="text-sm font-medium" style="color: var(--text-tertiary);">No FAQ data available</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'chat'" x-data="adminChat()" x-init="init()" class="h-full flex flex-col animate-in pb-4" x-cloak>
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                        <div>
                            <h1 class="text-4xl md:text-5xl font-black gradient-text-cmu mb-2">Unified Chat</h1>
                            <p class="font-medium" style="color: var(--text-secondary);">Unified Chat Facebook and other</p>
                        </div>
                        
                        <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Bot ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                        <div class="flex items-center gap-2">
                            <button @click="toggleAllBots(true)" 
                                    class="px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg flex items-center gap-2">
                                <i data-lucide="power" class="w-4 h-4"></i>
                                <span>‡πÄ‡∏õ‡∏¥‡∏î Bot ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                            </button>
                            <button @click="toggleAllBots(false)" 
                                    class="px-4 py-2 rounded-xl bg-gray-500 hover:bg-gray-600 text-white font-bold text-sm transition-all shadow-lg flex items-center gap-2">
                                <i data-lucide="power-off" class="w-4 h-4"></i>
                                <span>‡∏õ‡∏¥‡∏î Bot ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 card-enterprise rounded-3xl overflow-hidden flex shadow-2xl border-none min-h-[500px]">
                        <div class="w-80 border-r flex flex-col" style="background-color: var(--bg-tertiary); border-color: var(--border-primary);">
                            <div class="p-4 border-b" style="border-color: var(--border-primary);">
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4" style="color: var(--text-tertiary);"></i>
                                    <input type="text" 
                                           x-model="searchQuery"
                                           placeholder="Search customer name..." 
                                           class="w-full pl-10 pr-4 py-2 rounded-xl border-none text-sm shadow-inner focus:ring-2 focus:ring-purple-500 outline-none"
                                           style="background-color: var(--bg-secondary); color: var(--text-primary);">
                                </div>
                            </div>
                            <div class="flex-1 overflow-y-auto custom-scrollbar px-2 pt-2">
                                <template x-for="session in filteredSessions" :key="session.id">
                                    <div @click="selectSession(session)" 
                                         :class="currentSession?.id === session.id ? 'shadow-md scale-[1.02] border-l-4 border-purple-600' : 'opacity-70'"
                                         class="p-4 flex items-center gap-4 cursor-pointer transition-all rounded-2xl mb-2"
                                         :style="currentSession?.id === session.id ? 'background-color: var(--bg-secondary);' : ''">
                                        <div class="relative">
                                            <img :src="session.profile.picture" class="w-12 h-12 rounded-full object-cover border-2 shadow-sm" style="border-color: var(--bg-secondary);">
                                            <div :class="session.platform === 'facebook' ? 'bg-blue-500' : 'bg-green-500'" 
                                                 class="absolute -top-1 -right-1 w-5 h-5 border-2 rounded-full flex items-center justify-center shadow-sm"
                                                 style="border-color: var(--bg-secondary);">
                                                <i :data-lucide="session.platform === 'facebook' ? 'facebook' : 'globe'" class="w-2.5 h-2.5 text-white"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="font-bold truncate text-sm" style="color: var(--text-primary);" x-text="session.profile.name"></p>
                                            <div class="flex items-center gap-1">
                                                <span class="text-[9px] uppercase font-black tracking-widest" style="color: var(--text-tertiary);" x-text="session.platform"></span>
                                                <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á Bot Status -->
                                                <span class="ml-2 text-[9px] font-black px-2 py-0.5 rounded-full"
                                                      :class="session.bot_enabled ? 'bg-emerald-500/20 text-emerald-600' : 'bg-gray-400/20 text-gray-600'"
                                                      x-text="session.bot_enabled ? 'ü§ñ ON' : '‚õî OFF'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div class="flex-1 flex flex-col relative" style="background-color: var(--bg-secondary);">
                            <template x-if="currentSession">
                                <div class="h-full flex flex-col">
                                    <div class="p-5 border-b flex items-center justify-between z-10 shadow-sm" style="border-color: var(--border-primary); background-color: var(--bg-secondary);">
                                        <div class="flex items-center gap-4">
                                            <img :src="currentSession.profile.picture" class="w-10 h-10 rounded-full border shadow-sm" style="border-color: var(--border-primary);">
                                            <div>
                                                <h3 class="font-black text-lg leading-tight" style="color: var(--text-primary);" x-text="currentSession.profile.name"></h3>
                                                <p class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">Connected via <span x-text="currentSession.platform"></span></p>
                                            </div>
                                        </div>
                                        
                                        <!-- ‚úÖ ‡∏™‡∏•‡∏±‡∏ö Bot ‡∏ï‡πà‡∏≠ Session -->
                                        <div class="flex items-center gap-4 px-5 py-2 rounded-2xl border" style="background-color: var(--bg-tertiary); border-color: var(--border-primary);">
                                            <div class="flex flex-col items-end">
                                                <span class="text-[10px] font-black uppercase" style="color: var(--text-tertiary);">Auto Bot System</span>
                                                <span :class="currentSession.bot_enabled ? 'text-emerald-500' : ''" 
                                                      :style="!currentSession.bot_enabled ? 'color: var(--text-tertiary);' : ''"
                                                      class="text-xs font-bold" x-text="currentSession.bot_enabled ? 'ACTIVE' : 'DISABLED'"></span>
                                            </div>
                                            <button @click="toggleBot(currentSession)" 
                                                :class="currentSession.bot_enabled ? 'bg-emerald-500' : ''"
                                                :style="!currentSession.bot_enabled ? 'background-color: var(--border-primary);' : ''"
                                                class="w-12 h-6 rounded-full relative transition-all duration-300">
                                                <div :class="currentSession.bot_enabled ? 'translate-x-6' : 'translate-x-1'" 
                                                     class="absolute top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300"></div>
                                            </button>
                                        </div>
                                    </div>

                                    <div id="message-container" class="flex-1 p-6 overflow-y-auto flex flex-col gap-4 custom-scrollbar" style="background-color: var(--bg-tertiary);">
                                        <template x-for="msg in messages">
                                            <div :class="msg.role === 'user' ? 'self-start' : 'self-end'" class="flex flex-col max-w-[80%]">
                                                <div :class="msg.role === 'user' ? 'chat-bubble-user' : (msg.parts[0].text.startsWith('[Admin]') ? 'chat-bubble-admin' : 'chat-bubble-bot')">
                                                    <span class="text-sm font-medium leading-relaxed" x-text="msg.parts[0].text.replace('[Admin]: ', '')"></span>
                                                </div>
                                                <span class="text-[9px] mt-1 font-bold uppercase" 
                                                      :class="msg.role === 'user' ? 'text-left' : 'text-right'"
                                                      style="color: var(--text-tertiary);"
                                                      x-text="msg.role === 'user' ? 'Customer' : (msg.parts[0].text.startsWith('[Admin]') ? 'Admin' : 'Bot ‡∏û‡∏µ‡πà‡πÄ‡∏£‡πá‡∏Å')"></span>
                                            </div>
                                        </template>
                                    </div>

                                    <div class="p-5 border-t" style="border-color: var(--border-primary); background-color: var(--bg-secondary);">
                                        <div x-show="currentSession.bot_enabled" 
                                             class="mb-3 px-4 py-2 text-xs font-bold rounded-xl flex items-center gap-2"
                                             style="background-color: rgba(255, 149, 0, 0.1); color: var(--warning); border: 1px solid rgba(255, 149, 0, 0.2);">
                                            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                                            <span>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏¥‡∏î Auto Bot ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</span>
                                        </div>

                                        <div class="flex items-center gap-3">
                                            <button class="p-2 rounded-full transition-colors" 
                                                    style="color: var(--cmu-purple);"
                                                    :style="'background-color: ' + (currentSession.bot_enabled ? 'var(--bg-tertiary)' : 'transparent')">
                                                <i data-lucide="plus-circle" class="w-6 h-6"></i>
                                            </button>
                                            <input type="text" x-model="newMessage" @keyup.enter="sendMessage()" 
                                                   :disabled="currentSession.bot_enabled"
                                                   :placeholder="currentSession.bot_enabled ? '‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà...' : '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...'" 
                                                   class="flex-1 px-6 py-3 rounded-full border-none focus:ring-2 focus:ring-purple-500 outline-none text-sm font-medium transition-all"
                                                   :class="currentSession.bot_enabled ? 'opacity-50 cursor-not-allowed' : ''"
                                                   style="background-color: var(--bg-tertiary); color: var(--text-primary);">
                                            
                                            <button @click="sendMessage()" 
                                                    :disabled="currentSession.bot_enabled"
                                                    :class="currentSession.bot_enabled ? 'btn-disabled' : 'bg-purple-600 hover:bg-purple-700 shadow-lg hover:shadow-purple-500/30'"
                                                    class="text-white p-3 rounded-full transition-all">
                                                <i data-lucide="send" class="w-6 h-6"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="!currentSession">
                                <div class="h-full flex items-center justify-center" style="background-color: var(--bg-secondary);">
                                    <div class="text-center animate-in">
                                        <div class="w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner" style="background-color: var(--bg-tertiary);">
                                            <i data-lucide="message-circle" class="w-12 h-12" style="color: var(--border-primary);"></i>
                                        </div>
                                        <h3 class="text-xl font-black mb-2" style="color: var(--text-tertiary);">No Conversation Selected</h3>
                                        <p class="text-sm font-medium" style="color: var(--text-tertiary);">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'files'" x-cloak id="files-container"></div>

                <div x-show="activeTab === 'logs'" x-cloak id="logs-container"></div>

                <div x-show="activeTab === 'database'" x-cloak id="database-container"></div>
            </div>
        </main>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="/static/js/admin/app-core.js"></script>
    <script src="/static/js/admin/app-chat.js"></script>
    <script src="/static/js/admin/app-files.js"></script>
    <script src="/static/js/admin/app-logs.js"></script>
    <script src="/static/js/admin/app-database.js"></script>
    <script>
        lucide.createIcons();
        document.addEventListener('alpine:initialized', () => {
            setInterval(() => lucide.createIcons(), 500);
        });
    </script>
</body>
</html>